/* Gradio 5.38.0 の main に付く構成をそのまま踏襲して勝ちに行く */
.gradio-container-5-38-0 main.fillable.app.fill_width[class*="svelte-"] {
  padding-left: 0 !important;
  padding-right: 0 !important;
}
/* ヘッダー */
#chat_header {
  position: fixed;
  top: 0;
  left: 0;
  height: 1.5rem;
  z-index: 100;
  background: var(--body-background-fill);
  border-bottom: 1px solid var(--border-color-primary);
  width: 100vw;
  margin-left: auto;
  margin-right: auto;
  margin-bottom: auto;
  padding-left: 2rem;
  padding-right: 2rem;
}

/* チャット欄をスクロール領域として分離 */
:root { --composer-h: 5rem; }
#chat_scroll_area {
  height: calc(100dvh - var(--composer-h));
  overflow-y: auto;
  transition: height 0.1s;
  padding-bottom: 5rem !important;
  background: transparent;
}

/* 入力欄を画面下部に固定 */
#composer_fixed {
  position: fixed;
  left: 0; right: 0; bottom: 0;
  z-index: 100;
  background: var(--body-background-fill);
  border-top: 1px solid var(--border-color-primary);
  box-shadow: 0 -2px 8px rgba(0,0,0,0.15);
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
}
body { padding-bottom: 0 !important; }

#my_chat {
  height: 100% !important;
}

.saiverse-home {
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
  width: 100%;
  padding-left: 1.5rem;
  padding-right: 1.5rem;
  box-sizing: border-box;
}

#section-home .gr-markdown,
#section-home .gr-button {
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
}

@media (max-width: 768px) {
  .saiverse-home {
    padding-left: 1rem;
    padding-right: 1rem;
  }
}

/* === モバイルで Chatbot 親ブロックの左右パディングを完全に殺す === */
@media (max-width: 680px) {
  /* 親ブロック特定（:has はそのまま・@supports は外す） */
  :is(.gr-block, .gr-column, .gr-row, .group, .tabitem):has(> #chat_wrap):not(.sidebar-parent),
  :is(.gr-block, .gr-column, .gr-row, .group, .tabitem):has(#my_chat):not(.sidebar-parent) {
    padding-left: 0 !important;
    padding-right: 0 !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
    max-width: 100% !important;
    width: 100% !important;
  }

  /* フォールバック：親の内側余白を“子から”物理的に打ち消す */
  #chat_wrap {
    /* ビューポートいっぱいに拡げて親のpaddingを無効化 */
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: calc(50% - 50vw) !important;
    margin-right: calc(50% - 50vw) !important;
  }

  /* Chatbot 本体も全幅に */
  #my_chat {
    max-width: 100vw !important;
    width: 100vw !important;
    padding-bottom: 0 !important;
  }

  /* Markdown クランプ解除（保険） */
  #my_chat .prose, #my_chat [class*="prose"] { max-width: none !important; }

  /* 長文の折返し */
  #my_chat pre { white-space: pre-wrap !important; word-break: break-word !important; }
}

/* iOS セーフエリア（必要なら併用可：viewport-fit=cover を head に入れている前提） */
@supports (padding: env(safe-area-inset-left)) {
  body {
    padding-left: max(0px, env(safe-area-inset-left));
    padding-right: max(0px, env(safe-area-inset-right));
  }
}

html[data-theme='light'] {
  --msg-bg: #f3f4f6;
  --msg-fg: #111827;
  --user-bg: #dbeafe;  /* light blue */
  --user-fg: #111827;
  --note-bg: #fff9db;
  --note-fg: #1f2937;
  --timestamp-fg: #6b7280;
}
html[data-theme='dark'] {
  --msg-bg: #333333;
  --msg-fg: #f9fafb;
  --user-bg: #1f3b57; /* darker blue for contrast */
  --user-fg: #e5e7eb;
  --note-bg: #3b3a2a;
  --note-fg: #f3f4f6;
  --timestamp-fg: #9ca3af;
}
/* Fallback to system preference if theme attr not present */
@media (prefers-color-scheme: dark) {
  :root:not([data-theme]) {
    --msg-bg: #333333;
    --msg-fg: #f9fafb;
    --user-bg: #1f3b57;
    --user-fg: #e5e7eb;
    --note-bg: #3b3a2a;
    --note-fg: #f3f4f6;
    --timestamp-fg: #9ca3af;
  }
}

/* --- 縦積みレイアウト --- */
.message-block { display: flex !important; flex-direction: column; align-items: flex-start; gap: 8px;}
.message-block .avatar-top { width: 60px; height: 60px; min-width: 60px; border-radius: 12px !important; overflow: hidden; margin: 0 !important; display: inline-block; }
.message-block .avatar-top img { width: 100%; height: 100%; object-fit: cover; border-radius: inherit !important; display: block; }
.message-header { display: flex !important; align-items: center; gap: 12px; width: 100%; }
.message-header .speaker-name { font-weight: 600; font-size: 0.95rem; color: var(--msg-fg); }
.message-block.user .message-header .speaker-name { color: var(--user-fg); }
.message-block .bubble { padding: 12px 16px; background-color: var(--msg-bg); color: var(--msg-fg) !important; border-radius: 12px; font-size: 1rem !important; overflow-wrap: break-word; max-width: min(640px, 90vw); box-shadow: 0 2px 6px rgba(0,0,0,0.08); display: flex; flex-direction: column; gap: 8px; }
.message-block.user .bubble { background-color: var(--user-bg); color: var(--user-fg) !important; }
.message-block .bubble .bubble-content { line-height: 1.6; }
.message-block .bubble .bubble-meta { font-size: 0.75rem; color: var(--timestamp-fg); align-self: flex-end; white-space: nowrap; }
.message-block.user { align-items: flex-start; text-align: left; }
.message-block.user .avatar-top { align-self: flex-start; }
.message-block.host { align-items: flex-start; }
.message-block.host .avatar-top { align-self: flex-start; }

.message-wrap {
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
  width: 100%;
}

/* ユーザー側（右寄せ、幅狭め） */
.message-row.bubble.user-row {
  max-width: 520px;
  margin-left: auto;
  margin-right: 0;
  text-align: left;
}

/* アシスタント側（左寄せ、幅広め） */
.message-row.bubble.bot-row {
  max-width: 700px;
  margin-left: 0;
  margin-right: auto;
  text-align: left;
}

#my_chat .message,
#my_chat .message.user,
#my_chat .message.assistant {
  justify-content: flex-start !important;
  text-align: left !important;
}
#my_chat .message .avatar,
#my_chat .message .message-avatar,
#my_chat .message .chatbot-avatar,
#my_chat .message svg {
  display: none !important;
}
#my_chat .message .chatbot-message,
#my_chat .message .message-content {
  background: transparent !important;
  box-shadow: none !important;
  padding: 0 !important;
}

/* Notes */
.note-box { background: var(--note-bg); color: var(--note-fg) !important; border-left: 4px solid #ffbf00; padding: 8px 12px; margin: 0; border-radius: 6px; font-size: .92rem; }
.note-box b { color: var(--note-fg) !important; }

.saiverse-move-radio .wrap {
  display: flex !important;
  flex-direction: column !important;
  gap: 6px;
}

  gap: 6px;
}
.saiverse-move-radio .wrap label {
  margin: 0 !important;
}
/* Reasoning (Thinking) blocks */
details.saiv-thinking { margin-top: 10px; border: 1px solid rgba(128,128,128,0.25); border-radius: 8px; padding: 8px 12px; background: rgba(0,0,0,0.02); }
html[data-theme='dark'] details.saiv-thinking { background: rgba(255,255,255,0.04); border-color: rgba(255,255,255,0.12); }
details.saiv-thinking summary { cursor: pointer; font-weight: 600; outline: none; }
details.saiv-thinking summary:focus { outline: none; }
.saiv-thinking-body { margin-top: 6px; display: flex; flex-direction: column; gap: 8px; font-size: 0.96rem; color: inherit; }
.saiv-thinking-item { border-top: 1px solid rgba(128,128,128,0.2); padding-top: 6px; }
.saiv-thinking-item:first-child { border-top: none; padding-top: 0; }
.saiv-thinking-title { font-weight: 600; margin-bottom: 4px; }
.saiv-thinking-text { line-height: 1.45; word-break: break-word; }

/* Strongly scoped avatar rounding for Chatbot area */
#my_chat .saiv-avatar { border-radius: 12px !important; overflow: hidden !important; display: inline-block; width: 60px; height: 60px; min-width: 60px; }
#my_chat .saiv-avatar > img { border-radius: 12px !important; margin: 0 !important; width: 100% !important; height: 100% !important; object-fit: cover !important; display: block !important; clip-path: inset(0 round 12px) !important; }
#my_chat .saiv-avatar > picture > img { border-radius: 12px !important; margin: 0 !important; clip-path: inset(0 round 12px) !important; }

:global(.saiverse-sidebar.sidebar) {
  width: 20vw !important;
}
:global(.saiverse-sidebar.sidebar):not(.right) {
  left: calc(-1 * 20vw) !important;
}
:global(.saiverse-sidebar.sidebar).right {
  right: calc(-1 * 20vw) !important;
}

/* Sidebar toggle を押しやすく */
:global(.saiverse-sidebar.sidebar) .toggle-button {
  width: 56px !important;
  height: 56px !important;
  padding: 0 !important;
}
:global(.saiverse-sidebar.sidebar):not(.right) .toggle-button,
:global(.saiverse-sidebar.sidebar).open:not(.right) .toggle-button {
  border-radius: 0 28px 28px 0 !important;
}
:global(.saiverse-sidebar.sidebar).right .toggle-button,
:global(.saiverse-sidebar.sidebar).open.right .toggle-button {
  border-radius: 28px 0 0 28px !important;
}
:global(.saiverse-sidebar.sidebar) .chevron {
  padding-right: 0 !important;
}
:global(.saiverse-sidebar.sidebar) .chevron-left {
  width: 18px !important;
  height: 18px !important;
  border-top-width: 3px !important;
  border-right-width: 3px !important;
}

#saiverse-sidebar-nav {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 12px;
}
#saiverse-sidebar-nav .saiverse-nav-item {
  cursor: pointer;
  padding: 8px 12px;
  border-radius: 8px;
  color: inherit;
  background: transparent;
  transition: background-color 0.2s ease, color 0.2s ease;
}
#saiverse-sidebar-nav .saiverse-nav-item:hover {
  background: rgba(0, 0, 0, 0.08);
}
html[data-theme='dark'] #saiverse-sidebar-nav .saiverse-nav-item:hover {
  background: rgba(255, 255, 255, 0.1);
}
#saiverse-sidebar-nav .saiverse-nav-item.active {
  font-weight: 600;
  background: rgba(64, 128, 255, 0.16);
  color: inherit;
}
html[data-theme='dark'] #saiverse-sidebar-nav .saiverse-nav-item.active {
  background: rgba(64, 128, 255, 0.28);
}
.saiverse-section.saiverse-hidden {
  display: none !important;
}

.saiv-image-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  margin-top: 8px;
}
.saiv-image-grid img {
  max-width: 240px;
  height: auto;
  border-radius: 8px;
  object-fit: cover;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}
html[data-theme='dark'] .saiv-image-grid img {
  box-shadow: 0 2px 6px rgba(255, 255, 255, 0.1);
}

@media (max-width: 768px) {
  :global(.saiverse-sidebar.sidebar) {
    width: 60vw !important;
  }
  :global(.saiverse-sidebar.sidebar):not(.right) {
    left: -60vw !important;
  }
  :global(.saiverse-sidebar.sidebar).right {
    right: -60vw !important;
  }
}

#message_input_row {
  align-items: flex-end;
  gap: 8px;
}
#attachment_button {
  width: auto !important;
  min-width: 0 !important;
}
#attachment_button button {
  width: 44px !important;
  height: 44px !important;
  border-radius: 50% !important;
  display: flex !important;
  align-items: center;
  justify-content: center;
  padding: 0 !important;
  font-size: 1.4rem !important;
  line-height: 1 !important;
}
#attachment_button button .icon,
#attachment_button button span {
  pointer-events: none;
}
#chat_message_textbox textarea {
  border-radius: 12px;
}
#chat_message_textbox textarea.drop-target-active {
  border-color: #2563eb !important;
  box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.25);
}
