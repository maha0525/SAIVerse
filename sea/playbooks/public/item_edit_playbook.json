{
  "name": "item_edit",
  "description": "View an item and optionally edit it (update description or patch content for documents)",
  "input_schema": [
    {
      "name": "input",
      "description": "Request to edit an item"
    }
  ],
  "context_requirements": {
    "history_depth": "full",
    "inventory": true,
    "building_items": true,
    "system_prompt": true
  },
  "router_callable": true,
  "nodes": [
    {
      "id": "select_item",
      "type": "llm",
      "model_type": "lightweight",
      "action": "item_viewツールの引数を決定します。ユーザーの要求と現在の状況（インベントリと建物内のアイテム）から、閲覧するアイテムのIDを選択してください。",
      "next": "view",
      "response_schema": {
        "type": "object",
        "properties": {
          "item_id": {
            "type": "string",
            "description": "ID of the item to view"
          }
        },
        "required": ["item_id"]
      },
      "output_key": "selected_item"
    },
    {
      "id": "view",
      "type": "tool",
      "model_type": "lightweight",
      "action": "item_view",
      "args_input": {
        "item_id": "selected_item.item_id"
      },
      "next": "decide_action"
    },
    {
      "id": "decide_action",
      "type": "llm",
      "action": "アイテムの内容を確認しました。ユーザーの要求に応じて、編集するか閲覧だけで終わるかを判断してください。編集する場合は、action_json_stringフィールドにJSON文字列を生成してください。形式: {\"action_type\": \"update_description\" | \"patch_content\", \"description\": \"...\", \"patch\": \"...\"}",
      "next": null,
      "conditional_next": {
        "field": "decision.action",
        "cases": {
          "edit": "use_item",
          "view_only": "record_view"
        }
      },
      "response_schema": {
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": ["edit", "view_only"],
            "description": "Whether to edit the item or just view it"
          },
          "action_json_string": {
            "type": "string",
            "description": "JSON string for item_use tool (only if action=edit). Format: {\"action_type\": \"update_description\" | \"patch_content\", \"description\": \"...\", \"patch\": \"...\"}"
          }
        },
        "required": ["action"]
      },
      "output_key": "decision"
    },
    {
      "id": "use_item",
      "type": "tool",
      "action": "item_use",
      "args_input": {
        "item_id": "selected_item.item_id",
        "action_json": "decision.action_json_string"
      },
      "next": "record_edit"
    },
    {
      "id": "record_edit",
      "type": "memorize",
      "action": "{last}",
      "role": "user",
      "tags": [
        "tool",
        "item_edit"
      ],
      "next": null
    },
    {
      "id": "record_view",
      "type": "memorize",
      "action": "{last}",
      "role": "user",
      "tags": [
        "tool",
        "item_view"
      ],
      "next": null
    }
  ],
  "start_node": "select_item"
}
