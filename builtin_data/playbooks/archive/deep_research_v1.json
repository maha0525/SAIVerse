{
    "name": "deep_research",
    "display_name": "æ·±ã„èª¿æŸ»",
    "description": "ãƒˆãƒ”ãƒƒã‚¯ã«ã¤ã„ã¦æ·±ãèª¿æŸ»ã—ã€è¤‡æ•°ã®æƒ…å ±æºã‹ã‚‰æƒ…å ±ã‚’åé›†ã—ã¦ãƒ¬ãƒãƒ¼ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã™ã‚‹",
    "input_schema": [
        {
            "name": "input",
            "description": "èª¿æŸ»ã—ãŸã„ãƒˆãƒ”ãƒƒã‚¯ã‚„è³ªå•"
        }
    ],
    "context_requirements": {
        "history_depth": "10messages",
        "history_balanced": false,
        "include_internal": false,
        "system_prompt": true,
        "memory_weave": true,
        "working_memory": false,
        "inventory": false,
        "building_items": true,
        "available_playbooks": false,
        "visual_context": false,
        "realtime_context": true
    },
    "router_callable": true,
    "nodes": [
        {
            "id": "init",
            "type": "set",
            "assignments": {
                "loop_count": 0,
                "max_loops": 10,
                "accumulated_info": "",
                "sources": "",
                "research_topic": "{input}"
            },
            "next": "build_query"
        },
        {
            "id": "build_query",
            "type": "llm",
            "model_type": "lightweight",
            "action": "<system>èª¿æŸ»ãƒˆãƒ”ãƒƒã‚¯ã€Œ{research_topic}ã€ã«ã¤ã„ã¦ã€ã“ã‚Œã¾ã§ã«åé›†ã—ãŸæƒ…å ±ã‚’è¸ã¾ãˆã¦æ¬¡ã®æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\n\nåé›†æ¸ˆã¿æƒ…å ±:\n{accumulated_info}\n\næƒ…å ±ãŒã¾ã ãªã„å ´åˆã¯åŸºæœ¬çš„ãªæ¤œç´¢ã‹ã‚‰ã€æ—¢ã«ã‚ã‚‹å ´åˆã¯ä¸è¶³ã—ã¦ã„ã‚‹è¦³ç‚¹ã‚’è£œã†æ¤œç´¢ã‚’è¡Œã£ã¦ãã ã•ã„ã€‚</system>",
            "response_schema": {
                "type": "object",
                "properties": {
                    "query": {
                        "type": "string",
                        "description": "æ¤œç´¢ã‚¯ã‚¨ãƒª"
                    },
                    "max_results": {
                        "type": "integer",
                        "description": "å–å¾—ä»¶æ•°ï¼ˆ3-10ï¼‰"
                    },
                    "rationale": {
                        "type": "string",
                        "description": "ã“ã®ã‚¯ã‚¨ãƒªã‚’é¸ã‚“ã ç†ç”±"
                    }
                },
                "required": [
                    "query"
                ]
            },
            "output_key": "search_args",
            "next": "log_query"
        },
        {
            "id": "log_query",
            "type": "memorize",
            "action": "ğŸ” æ¤œç´¢ã‚¯ã‚¨ãƒª: {search_args.query}",
            "role": "assistant",
            "tags": [
                "tool",
                "deep_research"
            ],
            "next": "search"
        },
        {
            "id": "search",
            "type": "tool",
            "action": "searxng_search",
            "args_input": {
                "query": "search_args.query",
                "max_results": "search_args.max_results"
            },
            "output_key": "search_results",
            "next": "select_pages"
        },
        {
            "id": "select_pages",
            "type": "llm",
            "model_type": "lightweight",
            "action": "<system>æ¤œç´¢çµæœã‹ã‚‰ã€èª¿æŸ»ãƒˆãƒ”ãƒƒã‚¯ã€Œ{research_topic}ã€ã«é–¢é€£ã™ã‚‹æœ‰ç”¨ãªãƒšãƒ¼ã‚¸ã‚’æœ€å¤§3ä»¶é¸ã‚“ã§ãã ã•ã„ã€‚æ—¢ã«èª¿ã¹ãŸæƒ…å ±æºã¯é¿ã‘ã¦ãã ã•ã„ã€‚\n\næ¤œç´¢çµæœ:\n{search_results}\n\næ—¢ã«èª¿ã¹ãŸã‚½ãƒ¼ã‚¹:\n{sources}</system>",
            "response_schema": {
                "type": "object",
                "properties": {
                    "selected_urls": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "èª­ã¿è¾¼ã‚€URLã®ãƒªã‚¹ãƒˆï¼ˆæœ€å¤§3ä»¶ï¼‰"
                    },
                    "skip_reason": {
                        "type": "string",
                        "description": "URLã‚’é¸ã°ãªã‹ã£ãŸå ´åˆã®ç†ç”±"
                    }
                },
                "required": [
                    "selected_urls"
                ]
            },
            "output_key": "page_selection",
            "next": "check_selection"
        },
        {
            "id": "check_selection",
            "type": "pass",
            "conditional_next": {
                "field": "page_selection.selected_urls.length",
                "operator": "gte",
                "cases": {
                    "1": "read_page_1",
                    "default": "check_done"
                }
            }
        },
        {
            "id": "read_page_1",
            "type": "tool",
            "action": "read_url_content",
            "args_input": {
                "url": "page_selection.selected_urls.0",
                "max_chars": 6000
            },
            "output_key": "page_content_1",
            "next": "summarize_1"
        },
        {
            "id": "summarize_1",
            "type": "llm",
            "model_type": "lightweight",
            "action": "<system>ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸å†…å®¹ã‹ã‚‰ã€èª¿æŸ»ãƒˆãƒ”ãƒƒã‚¯ã€Œ{research_topic}ã€ã«é–¢é€£ã™ã‚‹é‡è¦ãªæƒ…å ±ã‚’300-500æ–‡å­—ã§è¦ç´„ã—ã¦ãã ã•ã„ã€‚äº‹å®Ÿã¨æ•°å­—ã‚’å„ªå…ˆçš„ã«æŠ½å‡ºã™ã‚‹ã“ã¨ã€‚\n\nãƒšãƒ¼ã‚¸å†…å®¹:\n{page_content_1}</system>",
            "response_schema": {
                "type": "object",
                "properties": {
                    "summary": {
                        "type": "string",
                        "description": "ãƒšãƒ¼ã‚¸ã®è¦ç´„"
                    },
                    "key_facts": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "é‡è¦ãªäº‹å®Ÿã®ãƒªã‚¹ãƒˆ"
                    }
                },
                "required": [
                    "summary"
                ]
            },
            "output_key": "summary_1",
            "next": "accumulate_1"
        },
        {
            "id": "accumulate_1",
            "type": "set",
            "assignments": {
                "accumulated_info": "{accumulated_info}\n\n---\nğŸ“„ {page_selection.selected_urls.0}\n{summary_1.summary}",
                "sources": "{sources}\n{page_selection.selected_urls.0}"
            },
            "next": "check_more_pages"
        },
        {
            "id": "check_more_pages",
            "type": "pass",
            "conditional_next": {
                "field": "page_selection.selected_urls.length",
                "operator": "gte",
                "cases": {
                    "2": "read_page_2",
                    "default": "check_done"
                }
            }
        },
        {
            "id": "read_page_2",
            "type": "tool",
            "action": "read_url_content",
            "args_input": {
                "url": "page_selection.selected_urls.1",
                "max_chars": 6000
            },
            "output_key": "page_content_2",
            "next": "summarize_2"
        },
        {
            "id": "summarize_2",
            "type": "llm",
            "model_type": "lightweight",
            "action": "<system>ä»¥ä¸‹ã®ãƒšãƒ¼ã‚¸å†…å®¹ã‹ã‚‰ã€èª¿æŸ»ãƒˆãƒ”ãƒƒã‚¯ã€Œ{research_topic}ã€ã«é–¢é€£ã™ã‚‹é‡è¦ãªæƒ…å ±ã‚’300-500æ–‡å­—ã§è¦ç´„ã—ã¦ãã ã•ã„ã€‚\n\nãƒšãƒ¼ã‚¸å†…å®¹:\n{page_content_2}</system>",
            "response_schema": {
                "type": "object",
                "properties": {
                    "summary": {
                        "type": "string"
                    },
                    "key_facts": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        }
                    }
                },
                "required": [
                    "summary"
                ]
            },
            "output_key": "summary_2",
            "next": "accumulate_2"
        },
        {
            "id": "accumulate_2",
            "type": "set",
            "assignments": {
                "accumulated_info": "{accumulated_info}\n\n---\nğŸ“„ {page_selection.selected_urls.1}\n{summary_2.summary}",
                "sources": "{sources}\n{page_selection.selected_urls.1}"
            },
            "next": "check_done"
        },
        {
            "id": "check_done",
            "type": "llm",
            "model_type": "lightweight",
            "action": "<system>èª¿æŸ»ãƒˆãƒ”ãƒƒã‚¯ã€Œ{research_topic}ã€ã«ã¤ã„ã¦ã€åé›†ã—ãŸæƒ…å ±ãŒååˆ†ã‹ã©ã†ã‹åˆ¤æ–­ã—ã¦ãã ã•ã„ã€‚\n\nåé›†æ¸ˆã¿æƒ…å ±:\n{accumulated_info}\n\nãƒ«ãƒ¼ãƒ—å›æ•°: {loop_count}/{max_loops}\n\nä»¥ä¸‹ã‚’è€ƒæ…®ã—ã¦åˆ¤æ–­:\n- ãƒˆãƒ”ãƒƒã‚¯ã®ä¸»è¦ãªå´é¢ãŒã‚«ãƒãƒ¼ã•ã‚Œã¦ã„ã‚‹ã‹\n- ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã‹ã‚‰æƒ…å ±ãŒå¾—ã‚‰ã‚Œã¦ã„ã‚‹ã‹\n- ãƒ¬ãƒãƒ¼ãƒˆã‚’æ›¸ãã®ã«ååˆ†ãªå…·ä½“çš„æƒ…å ±ãŒã‚ã‚‹ã‹</system>",
            "response_schema": {
                "type": "object",
                "properties": {
                    "is_sufficient": {
                        "type": "boolean",
                        "description": "æƒ…å ±ãŒååˆ†ã‹ã©ã†ã‹"
                    },
                    "missing_aspects": {
                        "type": "string",
                        "description": "ä¸è¶³ã—ã¦ã„ã‚‹è¦³ç‚¹ï¼ˆã‚ã‚Œã°ï¼‰"
                    },
                    "next_search_suggestion": {
                        "type": "string",
                        "description": "æ¬¡ã«æ¤œç´¢ã™ã¹ãã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆä¸è¶³ã—ã¦ã„ã‚‹å ´åˆï¼‰"
                    }
                },
                "required": [
                    "is_sufficient"
                ]
            },
            "output_key": "sufficiency_check",
            "next": "decide_continue"
        },
        {
            "id": "decide_continue",
            "type": "pass",
            "conditional_next": {
                "field": "sufficiency_check.is_sufficient",
                "operator": "eq",
                "cases": {
                    "true": "generate_report",
                    "default": "inc_loop"
                }
            }
        },
        {
            "id": "inc_loop",
            "type": "set",
            "assignments": {
                "loop_count": "={loop_count} + 1"
            },
            "next": "check_loop_limit"
        },
        {
            "id": "check_loop_limit",
            "type": "pass",
            "conditional_next": {
                "field": "loop_count",
                "operator": "gte",
                "cases": {
                    "5": "generate_report",
                    "default": "build_query"
                }
            }
        },
        {
            "id": "generate_report",
            "type": "llm",
            "model_type": "normal",
            "action": "<system>èª¿æŸ»ãƒˆãƒ”ãƒƒã‚¯ã€Œ{research_topic}ã€ã«ã¤ã„ã¦ã€åé›†ã—ãŸæƒ…å ±ã‚’åŸºã«åŒ…æ‹¬çš„ãªãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\nåé›†æ¸ˆã¿æƒ…å ±:\n{accumulated_info}\n\nãƒ¬ãƒãƒ¼ãƒˆè¦ä»¶:\n- æ˜ç¢ºãªæ§‹æˆï¼ˆæ¦‚è¦ã€æœ¬æ–‡ã€çµè«–ï¼‰\n- æƒ…å ±æºã®æ˜è¨˜\n- äº‹å®Ÿã«åŸºã¥ã„ãŸå®¢è¦³çš„ãªè¨˜è¿°\n- èª­ã¿ã‚„ã™ã„Markdownå½¢å¼</system>",
            "response_schema": {
                "type": "object",
                "properties": {
                    "title": {
                        "type": "string",
                        "description": "ãƒ¬ãƒãƒ¼ãƒˆã®ã‚¿ã‚¤ãƒˆãƒ«"
                    },
                    "content": {
                        "type": "string",
                        "description": "ãƒ¬ãƒãƒ¼ãƒˆæœ¬æ–‡ï¼ˆMarkdownå½¢å¼ï¼‰"
                    },
                    "summary": {
                        "type": "string",
                        "description": "ãƒ¬ãƒãƒ¼ãƒˆã®è¦ç´„ï¼ˆ1-2æ–‡ï¼‰"
                    }
                },
                "required": [
                    "title",
                    "content",
                    "summary"
                ]
            },
            "output_key": "report",
            "next": "create_document"
        },
        {
            "id": "create_document",
            "type": "tool",
            "action": "document_create",
            "args_input": {
                "name": "report.title",
                "description": "report.summary",
                "content": "report.content"
            },
            "output_key": "doc_result",
            "next": "notify_complete"
        },
        {
            "id": "notify_complete",
            "type": "memorize",
            "action": "<system>ğŸ“ ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªã‚µãƒ¼ãƒå®Œäº†\n\nãƒˆãƒ”ãƒƒã‚¯: {research_topic}\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: ã€Œ{report.title}ã€ã‚’ä½œæˆã—ã¾ã—ãŸã€‚\nèª¿æŸ»ãƒ«ãƒ¼ãƒ—: {loop_count}å›\næƒ…å ±æº: {sources}\n\nçµæœ: {doc_result}</system>",
            "role": "user",
            "tags": [
                "tool",
                "deep_research",
                "complete"
            ],
            "next": null
        }
    ],
    "start_node": "init"
}
