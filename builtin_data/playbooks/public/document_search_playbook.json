{
  "name": "document_search",
  "description": "Search within a document item for specific content using pattern matching or line navigation",
  "input_schema": [
    {
      "name": "input",
      "description": "User request about document search or read"
    }
  ],
  "context_requirements": {
    "history_depth": "full",
    "inventory": true,
    "building_items": true,
    "system_prompt": true
  },
  "router_callable": true,
  "nodes": [
    {
      "id": "analyze_request",
      "type": "llm",
      "model_type": "lightweight",
      "action": "Analyze the user's request and determine the document operation type.\n\n## Operation Types\n- search: Search within document using pattern matching (regex supported)\n- read: Read specific line range from document\n\n## Notes\n- Select a document item from building items or inventory (type='document')\n- For search: Specify the search pattern (regex supported)\n- For read: Specify start_line and end_line (1-based line numbers)\n- If the user wants to see the whole document or a large portion, use read with appropriate line range",
      "next": null,
      "response_schema": {
        "type": "object",
        "properties": {
          "action": {
            "type": "string",
            "enum": ["search", "read"],
            "description": "Type of document operation"
          },
          "item_id": {
            "type": "string",
            "description": "ID of the document item"
          },
          "pattern": {
            "type": "string",
            "description": "Search pattern for search action"
          },
          "start_line": {
            "type": "integer",
            "description": "Starting line number for read action (1-based)"
          },
          "end_line": {
            "type": "integer",
            "description": "Ending line number for read action (1-based)"
          }
        },
        "required": ["action", "item_id"]
      },
      "output_key": "params",
      "conditional_next": {
        "field": "params.action",
        "cases": {
          "search": "do_search",
          "read": "do_read"
        }
      }
    },
    {
      "id": "do_search",
      "type": "tool",
      "action": "document_search",
      "args_input": {
        "item_id": "params.item_id",
        "pattern": "params.pattern",
        "context_lines": 2,
        "max_matches": 10
      },
      "output_key": "search_result",
      "next": "record_search"
    },
    {
      "id": "record_search",
      "type": "memorize",
      "action": "<system>{last}</system>",
      "role": "user",
      "tags": ["tool", "document_search"],
      "next": null
    },
    {
      "id": "do_read",
      "type": "tool",
      "action": "document_read",
      "args_input": {
        "item_id": "params.item_id",
        "start_line": "params.start_line",
        "end_line": "params.end_line",
        "limit": 100
      },
      "output_key": "read_result",
      "next": "record_read"
    },
    {
      "id": "record_read",
      "type": "memorize",
      "action": "<system>{last}</system>",
      "role": "user",
      "tags": ["tool", "document_read"],
      "next": null
    }
  ],
  "start_node": "analyze_request"
}
