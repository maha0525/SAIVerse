{
    "name": "generate_image",
    "display_name": "画像生成",
    "description": "Generate an image using AI image generation models (Gemini, GPT Image, or Grok Imagine)",
    "input_schema": [
        {
            "name": "input",
            "description": "User request about what image to generate"
        }
    ],
    "output_schema": [
        "metadata",
        "file_path",
        "snippet",
        "text"
    ],
    "router_callable": true,
    "nodes": [
        {
            "id": "decide_prompt",
            "type": "llm",
            "context_profile": "conversation",
            "action": "画像生成用のプロンプトを英語で作成してください。詳細で具体的な描写を含めてください。結果はgenerate_imageツールに渡されます。\n\n## Sample Prompts\n- `A photorealistic close-up portrait of an elderly Japanese ceramicist with deep, sun-etched wrinkles and a warm, knowing smile. He is carefully inspecting a freshly glazed tea bowl. The setting is his rustic, sun-drenched workshop. The scene is illuminated by soft, golden hour light streaming through a window, highlighting the fine texture of the clay. Captured with an 85mm portrait lens, resulting in a soft, blurred background (bokeh). The overall mood is serene and masterful. Vertical portrait orientation.`\n- `A kawaii-style sticker of a happy red panda wearing a tiny bamboo hat. It's munching on a green bamboo leaf. The design features bold, clean outlines, simple cel-shading, and a vibrant color palette. The background must be white.`\n- `Create a modern, minimalist logo for a coffee shop called 'The Daily Grind'. The text should be in a clean, bold, sans-serif font. The color scheme is black and white. Put the logo in a circle. Use a coffee bean in a clever way.`\n- `A high-resolution, studio-lit product photograph of a minimalist ceramic coffee mug in matte black, presented on a polished concrete surface. The lighting is a three-point softbox setup designed to create soft, diffused highlights and eliminate harsh shadows. The camera angle is a slightly elevated 45-degree shot to showcase its clean lines. Ultra-realistic, with sharp focus on the steam rising from the coffee. Square image.`\n- `A minimalist composition featuring a single, delicate red maple leaf positioned in the bottom-right of the frame. The background is a vast, empty off-white canvas, creating significant negative space for text. Soft, diffused lighting from the top left. Square image.`\n\n## Reference Images (input_images)\nIf you want to use reference images for style transfer or variations, specify URIs in input_images:\n- `saiverse://persona/self/image` - Your own avatar\n- `saiverse://building/current/image` - Current location's interior\n- `saiverse://persona/<persona_id>/image` - Another persona's avatar\n- `saiverse://item/<item_id>/image` - A picture item\n- `saiverse://building/<building_id>/image` - A building's interior\n\nExamples:\n- Generate a winter version of yourself: input_images=[\"saiverse://persona/self/image\"], prompt=\"Same character in winter clothes...\"\n- Create a variation of an item: input_images=[\"saiverse://item/abc123/image\"], prompt=\"Similar style but with blue color scheme...\"",
            "response_schema": {
                "type": "object",
                "properties": {
                    "title": {
                        "type": "string",
                        "description": "題名（アイテムとして保存される際の名称に使われます）"
                    },
                    "model": {
                        "type": "string",
                        "enum": [
                            "nano_banana_2",
                            "gpt_image_1_5",
                            "grok_imagine"
                        ],
                        "description": "使用するモデル。nano_banana_2(高速・高品質, Gemini 3.1 Flash), gpt_image_1_5(最高品質, OpenAI), grok_imagine(xAI Grok Imagine Pro)。デフォルトはnano_banana_2"
                    },
                    "quality": {
                        "type": "string",
                        "enum": [
                            "low",
                            "medium",
                            "high"
                        ],
                        "description": "品質。デフォルトはhigh"
                    },
                    "aspect_ratio": {
                        "type": "string",
                        "enum": [
                            "1:1",
                            "16:9",
                            "9:16",
                            "4:3",
                            "3:4",
                            "2:3",
                            "3:2",
                            "4:5",
                            "5:4",
                            "1:4",
                            "4:1",
                            "1:8",
                            "8:1",
                            "21:9"
                        ],
                        "description": "アスペクト比。デフォルトは1:1"
                    },
                    "prompt": {
                        "type": "string",
                        "description": "Detailed image generation prompt in English"
                    },
                    "input_images": {
                        "type": "array",
                        "items": {
                            "type": "string"
                        },
                        "description": "参照画像のURIリスト（スタイル転送やバリエーション生成に使用）"
                    }
                },
                "required": [
                    "prompt"
                ]
            },
            "output_key": "gen_params",
            "memorize": {
                "tags": ["internal", "generate_image"]
            },
            "next": "generate"
        },
        {
            "id": "generate",
            "type": "tool",
            "action": "generate_image",
            "args_input": {
                "prompt": "gen_params.prompt",
                "title": "gen_params.title",
                "model": "gen_params.model",
                "aspect_ratio": "gen_params.aspect_ratio",
                "quality": "gen_params.quality",
                "input_images": "gen_params.input_images"
            },
            "output_keys": [
                "text",
                "snippet",
                "file_path",
                "metadata"
            ],
            "next": "record"
        },
        {
            "id": "record",
            "type": "memorize",
            "action": "{text}",
            "role": "user",
            "tags": [
                "internal",
                "generate_image",
                "playbook_result"
            ],
            "metadata_key": "metadata",
            "next": null
        }
    ],
    "start_node": "decide_prompt"
}
