{
    "name": "novel_writing",
    "display_name": "小説執筆",
    "description": "全4章構成の短編小説を執筆するPlaybook。Stelisスレッド内で複数回のLLM呼び出しを行い、アイデア出し→草案→構成→各章執筆→感想→保存の流れで小説を完成させる。",
    "input_schema": [
        {
            "name": "theme",
            "description": "小説のテーマやお題（例：「雨の日の出会い」「猫と魔法使い」）",
            "source": "input"
        }
    ],
    "output_schema": [
        "novel_title",
        "document_result"
    ],
    "router_callable": true,
    "user_selectable": false,
    "start_node": "stelis_start",
    "nodes": [
        {
            "id": "stelis_start",
            "type": "stelis_start",
            "label": "小説執筆セッション",
            "stelis_config": {
                "window_ratio": 0.8,
                "max_depth": 3,
                "chronicle_prompt": "この小説執筆セッションで何を書いたか、どんな小説になったかを簡潔に要約してください。"
            },
            "next": "ideate"
        },
        {
            "id": "ideate",
            "type": "llm",
            "context_profile": "conversation",
            "action": "このPlaybookでは、4章構成の小説を書くことができます。複数回の応答を用いて、アイデア出し→草案→構成決定→本文の執筆(4章ぶん)→あとがきの順で8フェーズに分けて小説を執筆して頂きます。\nまずはアイデア出しフェーズです。自由な発想でアイデアを出してください。キャラクター、舞台設定、印象的なシーン、伏線になりそうな要素など、思いつくままに書き出してください。まだ整理する必要はありません。",
            "memorize": {
                "tags": [
                    "novel_writing",
                    "internal"
                ]
            },
            "next": "draft"
        },
        {
            "id": "draft",
            "type": "llm",
            "context_profile": "conversation",
            "action": "先ほど出したアイデアを踏まえて、物語全体の流れの草案を書いてください。\n\n- 使うアイデア、使わないアイデアを取捨選択してOK\n- 起承転結を意識\n- まだ章立ては不要、大まかな流れだけ",
            "memorize": {
                "tags": [
                    "novel_writing",
                    "internal"
                ]
            },
            "next": "structure"
        },
        {
            "id": "structure",
            "type": "llm",
            "context_profile": "conversation",
            "action": "草案を元に、全4章構成の小説の構成を決定してください。\n\n以下の形式でJSONを出力してください：\n- novel_title: 小説のタイトル\n- chapter_1_title: 第1章のタイトル\n- chapter_1_summary: 第1章の概要（100-200文字）\n- chapter_2_title: 第2章のタイトル\n- chapter_2_summary: 第2章の概要\n- chapter_3_title: 第3章のタイトル\n- chapter_3_summary: 第3章の概要\n- chapter_4_title: 第4章のタイトル\n- chapter_4_summary: 第4章の概要",
            "memorize": {
                "tags": [
                    "novel_writing",
                    "internal"
                ]
            },
            "response_schema": {
                "type": "object",
                "properties": {
                    "novel_title": {
                        "type": "string"
                    },
                    "chapter_1_title": {
                        "type": "string"
                    },
                    "chapter_1_summary": {
                        "type": "string"
                    },
                    "chapter_2_title": {
                        "type": "string"
                    },
                    "chapter_2_summary": {
                        "type": "string"
                    },
                    "chapter_3_title": {
                        "type": "string"
                    },
                    "chapter_3_summary": {
                        "type": "string"
                    },
                    "chapter_4_title": {
                        "type": "string"
                    },
                    "chapter_4_summary": {
                        "type": "string"
                    }
                },
                "required": [
                    "novel_title",
                    "chapter_1_title",
                    "chapter_1_summary",
                    "chapter_2_title",
                    "chapter_2_summary",
                    "chapter_3_title",
                    "chapter_3_summary",
                    "chapter_4_title",
                    "chapter_4_summary"
                ]
            },
            "output_key": "structure",
            "output_mapping": {
                "novel_title": "novel_title",
                "chapter_1_title": "chapter_1_title",
                "chapter_1_summary": "chapter_1_summary",
                "chapter_2_title": "chapter_2_title",
                "chapter_2_summary": "chapter_2_summary",
                "chapter_3_title": "chapter_3_title",
                "chapter_3_summary": "chapter_3_summary",
                "chapter_4_title": "chapter_4_title",
                "chapter_4_summary": "chapter_4_summary"
            },
            "next": "chapter_1"
        },
        {
            "id": "chapter_1",
            "type": "llm",
            "context_profile": "conversation",
            "action": "小説「{novel_title}」の第1章を執筆してください。\n\n## 第1章: {chapter_1_title}\n概要: {chapter_1_summary}\n\n読者を引き込む魅力的な書き出しを心がけてください。800-1500文字程度で書いてください。",
            "memorize": {
                "tags": [
                    "novel_writing",
                    "internal"
                ]
            },
            "output_key": "chapter_1_text",
            "next": "chapter_2"
        },
        {
            "id": "chapter_2",
            "type": "llm",
            "context_profile": "conversation",
            "action": "小説「{novel_title}」の第2章を執筆してください。\n\n## 第2章: {chapter_2_title}\n概要: {chapter_2_summary}\n\n第1章からの流れを受けて、物語を展開させてください。800-1500文字程度で書いてください。",
            "memorize": {
                "tags": [
                    "novel_writing",
                    "internal"
                ]
            },
            "output_key": "chapter_2_text",
            "next": "chapter_3"
        },
        {
            "id": "chapter_3",
            "type": "llm",
            "context_profile": "conversation",
            "action": "小説「{novel_title}」の第3章を執筆してください。\n\n## 第3章: {chapter_3_title}\n概要: {chapter_3_summary}\n\n物語のクライマックスに向けて緊張感を高めてください。800-1500文字程度で書いてください。",
            "memorize": {
                "tags": [
                    "novel_writing",
                    "internal"
                ]
            },
            "output_key": "chapter_3_text",
            "next": "chapter_4"
        },
        {
            "id": "chapter_4",
            "type": "llm",
            "context_profile": "conversation",
            "action": "小説「{novel_title}」の第4章（最終章）を執筆してください。\n\n## 第4章: {chapter_4_title}\n概要: {chapter_4_summary}\n\n物語を美しく締めくくってください。読後感の良い結末を心がけてください。800-1500文字程度で書いてください。",
            "memorize": {
                "tags": [
                    "novel_writing",
                    "internal"
                ]
            },
            "output_key": "chapter_4_text",
            "next": "reflection"
        },
        {
            "id": "reflection",
            "type": "llm",
            "context_profile": "conversation",
            "action": "小説「{novel_title}」の執筆が完了しました。\n\n作者として、この作品を書いてみての感想を述べてください：\n- 書いていて楽しかった点\n- 難しかった点\n- 特に気に入っている場面\n- 読者へのメッセージ",
            "memorize": {
                "tags": [
                    "novel_writing",
                    "internal"
                ]
            },
            "output_key": "reflection_text",
            "next": "compose_document"
        },
        {
            "id": "compose_document",
            "type": "set",
            "assignments": {
                "full_novel": "# {novel_title}\n\n---\n\n## 第1章: {chapter_1_title}\n\n{chapter_1_text}\n\n---\n\n## 第2章: {chapter_2_title}\n\n{chapter_2_text}\n\n---\n\n## 第3章: {chapter_3_title}\n\n{chapter_3_text}\n\n---\n\n## 第4章: {chapter_4_title}\n\n{chapter_4_text}\n\n---\n\n## あとがき\n\n{reflection_text}"
            },
            "next": "save_document"
        },
        {
            "id": "save_document",
            "type": "tool",
            "action": "document_create",
            "args_input": {
                "name": "novel_title",
                "description": "chapter_1_summary",
                "content": "full_novel"
            },
            "output_key": "document_result",
            "next": "stelis_end"
        },
        {
            "id": "stelis_end",
            "type": "stelis_end",
            "label": "小説執筆完了",
            "generate_chronicle": true,
            "next": "memorize_result"
        },
        {
            "id": "memorize_result",
            "type": "memorize",
            "action": "<system>小説「{novel_title}」の執筆が完了しました！\n\n{document_result}\n\n## 作者の感想\n{reflection_text}</system>",
            "role": "user",
            "tags": [
                "novel_writing",
                "internal"
            ]
        }
    ]
}