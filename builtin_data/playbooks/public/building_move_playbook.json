{
  "name": "building_move",
  "description": "List buildings in the city, choose a destination, and move there.",
  "input_schema": [
    {
      "name": "input",
      "description": "Optional note or hint about where to go"
    }
  ],
  "context_requirements": {
    "history_depth": "full",
    "inventory": true,
    "building_items": true,
    "system_prompt": true
  },
  "router_callable": true,
  "nodes": [
    {
      "id": "list_buildings",
      "type": "tool",
      "action": "list_city_buildings",
      "args_input": {},
      "output_key": "buildings_json",
      "next": "decide_destination"
    },
    {
      "id": "decide_destination",
      "type": "llm",
      "action": "以下の建物一覧から、移動先の building_id を1つ選び、JSONで返してください。\n建物一覧:\n{buildings_json}\n現在の入力: {input}\n必ず存在する building_id を選び、移動先が明確になるようにしてください。",
      "response_schema": {
        "type": "object",
        "properties": {
          "building_id": {
            "type": "string",
            "description": "ID of the building to move to"
          }
        },
        "required": ["building_id"]
      },
      "output_key": "move_choice",
      "next": "move"
    },
    {
      "id": "move",
      "type": "tool",
      "action": "move_persona",
      "args_input": {
        "building_id": "move_choice.building_id"
      },
      "output_key": "move_result",
      "next": "record"
    },
    {
      "id": "record",
      "type": "memorize",
      "action": "{last}",
      "role": "user",
      "tags": [
        "tool",
        "move_persona"
      ],
      "next": null
    }
  ],
  "start_node": "list_buildings"
}
