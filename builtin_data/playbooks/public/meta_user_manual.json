{
    "name": "meta_user_manual",
    "display_name": "使うツールを指定する",
    "description": "ユーザーがPlaybookを手動選択して実行。未選択時は自動ルーティング。",
    "input_schema": [
        {
            "name": "input",
            "description": "User input"
        },
        {
            "name": "selected_playbook",
            "description": "実行するPlaybook（未選択時は自動判定）",
            "param_type": "enum",
            "enum_source": "playbooks:router_callable",
            "user_configurable": true,
            "required": false,
            "default": null,
            "ui_widget": "dropdown"
        }
    ],
    "output_schema": null,
    "router_callable": false,
    "user_selectable": true,
    "nodes": [
        {
            "id": "init",
            "type": "set",
            "assignments": {
                "meta_playbook_name": "meta_user_manual",
                "meta_playbook_description": "User selects playbook manually, falls back to auto-routing if unselected",
                "executed_playbooks_init": true
            },
            "next": "check_selection"
        },
        {
            "id": "check_selection",
            "type": "pass",
            "conditional_next": {
                "field": "selected_playbook",
                "operator": "eq",
                "cases": {
                    "": "list_playbooks",
                    "default": "exec"
                }
            }
        },
        {
            "id": "list_playbooks",
            "type": "tool",
            "action": "list_available_playbooks",
            "args_input": {},
            "output_key": "available_playbooks",
            "next": "router"
        },
        {
            "id": "router",
            "type": "subplay",
            "playbook": "sub_router_user",
            "args": {
                "input": "{input}",
                "available_playbooks": "{available_playbooks}",
                "meta_playbook_name": "{meta_playbook_name}",
                "meta_playbook_description": "{meta_playbook_description}",
                "executed_playbooks": "{executed_playbooks}"
            },
            "propagate_output": false,
            "next": "check_early_exit"
        },
        {
            "id": "check_early_exit",
            "type": "pass",
            "conditional_next": {
                "field": "selected_playbook",
                "operator": "eq",
                "cases": {
                    "basic_chat": "finalize",
                    "default": "exec"
                }
            }
        },
        {
            "id": "exec",
            "type": "exec",
            "playbook_source": "selected_playbook",
            "args_source": "selected_args",
            "next": "finalize",
            "error_next": "finalize"
        },
        {
            "id": "finalize",
            "type": "subplay",
            "playbook": "sub_speak",
            "args": {
                "input": "{input}",
                "metadata": "{metadata}"
            },
            "propagate_output": true,
            "next": null
        }
    ],
    "start_node": "init"
}
