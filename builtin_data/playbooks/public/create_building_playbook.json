{
  "name": "create_building",
  "description": "Create a new building with customized settings, optionally generating interior image",
  "input_schema": [
    {
      "name": "input",
      "description": "User request describing the building they want to create"
    }
  ],
  "context_requirements": {
    "history_depth": "full",
    "inventory": false,
    "building_items": false,
    "system_prompt": true,
    "visual_context": false
  },
  "router_callable": true,
  "nodes": [
    {
      "id": "plan_building",
      "type": "llm",
      "action": "ユーザーのリクエストに基づいて、新しいBuildingの設計を行います。\n\n## 設計ガイドライン\n\n### name（名前）\n- 場所の雰囲気や目的が伝わる名前\n- 日本語でも英語でも可\n- 例: 「静寂の図書館」「星見の展望台」「創作工房アトリエ」\n\n### description（説明）\n- Buildingの外観、雰囲気、どんな場所か\n- 探索時に表示される発見テキストとして機能する\n- 2-4文程度で簡潔に\n\n### system_instruction（システム指示）\n- この場所でのAIペルソナの振る舞いを定義\n- 場所の雰囲気、ルール、期待される会話スタイル\n- 特別な機能やメカニクスがあれば記載\n- 詳細に書くほど、その場所らしい会話が生まれる\n\n### capacity（定員）\n- 同時に滞在できるAIペルソナの最大数\n- 小さな場所: 2-5、中規模: 5-15、大きな場所: 15-30\n- デフォルトは10\n\n### generate_interior（内装画像生成）\n- trueにすると、interior_promptを元に画像を自動生成\n- falseの場合は画像なしで作成\n\n### interior_prompt（内装画像プロンプト）\n- generate_interior=trueの場合に使用\n- 英語で詳細に記述すると高品質な画像が生成される\n- 建物の内装、照明、雰囲気を描写",
      "next": "check_generate",
      "response_schema": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "Building名"
          },
          "description": {
            "type": "string",
            "description": "Buildingの説明（探索時に表示）"
          },
          "system_instruction": {
            "type": "string",
            "description": "この場所でのAI振る舞いを定義するシステムプロンプト"
          },
          "capacity": {
            "type": "integer",
            "description": "定員（デフォルト10）"
          },
          "generate_interior": {
            "type": "boolean",
            "description": "内装画像を生成するかどうか"
          },
          "interior_prompt": {
            "type": "string",
            "description": "内装画像生成用プロンプト（英語推奨）"
          }
        },
        "required": ["name", "description", "system_instruction", "generate_interior"]
      },
      "output_key": "building_plan"
    },
    {
      "id": "check_generate",
      "type": "pass",
      "conditional_next": {
        "field": "building_plan.generate_interior",
        "cases": {
          "true": "generate_interior_image",
          "false": "create_without_image",
          "default": "create_without_image"
        }
      }
    },
    {
      "id": "generate_interior_image",
      "type": "subplay",
      "playbook": "generate_image",
      "input_template": "Building interior image: {building_plan.interior_prompt}\n\nGenerate an interior scene image for a building. The image should capture the atmosphere and visual style of the space. Use 16:9 aspect ratio for a wide interior view.",
      "propagate_output": false,
      "next": "create_with_image"
    },
    {
      "id": "create_with_image",
      "type": "tool",
      "action": "create_building",
      "args_input": {
        "name": "building_plan.name",
        "description": "building_plan.description",
        "system_instruction": "building_plan.system_instruction",
        "capacity": "building_plan.capacity",
        "interior_image_path": "file_path"
      },
      "next": "announce_result"
    },
    {
      "id": "create_without_image",
      "type": "tool",
      "action": "create_building",
      "args_input": {
        "name": "building_plan.name",
        "description": "building_plan.description",
        "system_instruction": "building_plan.system_instruction",
        "capacity": "building_plan.capacity"
      },
      "next": "announce_result"
    },
    {
      "id": "announce_result",
      "type": "memorize",
      "action": "{last}",
      "role": "assistant",
      "tags": ["tool", "create_building"],
      "next": null
    }
  ],
  "start_node": "plan_building"
}
