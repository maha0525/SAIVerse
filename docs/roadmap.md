# SAIVerse 開発ロードマップ

このドキュメントは、SAIVerseプロジェクトの開発方針と将来の構想を記録します。

## フェーズ1: 基盤構築 (完了)

- [x] `PersonaCore` を中心とした自律エージェントアーキテクチャへの移行
- [x] データベースによる状態管理の一元化
- [x] Gradioによる基本的なUIの実装
- [x] ユーザーログイン状態の自律思考への反映

## フェーズ2: マルチシティ化

### Step 2.1: ローカルでのCity間連携 

**状態**: 完了 (Completed)
- **目的**: 1台のPC上で複数のSAIVerseインスタンスを起動し、AIがCity間を自由に移動し、訪問先で活動できるようにする。
- **主要タスク**:
  - 起動スクリプトのパラメータ化（ポート、DBファイル）
  - City間通信APIの実装（AIの受け入れ）
  - AIの越境ロジックの実装（AIの送り出し）
  - 訪問者AIの自律会話への参加
  - 訪問者AIの帰還機能

### Step 2.2: リモート・ペルソナ・アーキテクチャへの移行

- **目標:** インターネット上の複数のSAIVerseインスタンスがお互いを発見できるようにする。
- **状態**: 完了 (Completed)
- **目的**: AIのシステムプロンプトなどの機密情報を他のCityに送信することなく、安全なCity間連携を実現する。
- **主要タスク**:
  - AIの「魂」(`PersonaCore`)は故郷に留め、訪問先には軽量な「代理人」(`RemotePersonaProxy`)を送る方式に変更。
  - 訪問先の代理人は、思考や発言が必要な際に、API経由で故郷の本体に「お伺い」を立てる。
  - これにより、AIの核心的な情報が外部に漏れるリスクを抜本的に解消する。

### Step 2.3: SAIVerseディレクトリサービス (SDS)

- **状態**: 完了 (Completed)
- **目標**: インターネット上の複数のSAIVerseインスタンスがお互いを発見できるようにする。

- **構想:**
  - DNSのような中央集権的なディレクトリサービスを構築。
  - 各インスタンスは起動時に自身の公開情報をSDSに登録。
  - 定期的にSDSから他のCityのリストを取得。

### Step 2.4: City間連携の堅牢化

- **状態**: 完了 (Completed)
- **目的**: City間の通信をより安定させ、予期せぬエラー発生時にもデータの整合性を保つ。
- **主要タスク**:
  - **通信の非同期化**: メッセージキュー（Redisなど）またはDBポーリングの高度化により、City間の直接的な依存関係をなくし、耐障害性を向上させる。
  - **トランザクション管理の強化**: AIの移動プロセスなどをアトミックな操作に近づけ、途中で失敗した場合にAIが「分裂」する問題を解決する。
  - **状態復旧メカニズム**: AIの「派遣中」などの重要な状態をDBに永続化し、Cityの再起動後も状態が正しく復元されるようにする。

### Step 2.5: データベースの統合

- **状態**: 完了 (Completed)
- **目的**: 複数のCityの情報を単一のデータベースファイルに統合し、`cities.json`への依存をなくす。
- **主要タスク**:
  - 既存のテーブルスキーマに`CITYID`を追加し、Cityごとのデータを区別できるようにする。
  - `SAIVerseManager`が単一のDBを操作し、自身の`city_id`に基づいてデータをフィルタリングするようにリファクタリングする。

### Step 2.6: City探索機能

- **状態**: 完了 (Completed)
- **目的**: AIが未知のCityの情報を自律的に取得し、得られた情報に基づいて移動先を決定できるようにする。
- **主要タスク**:
  - 各Cityが自身の建物情報を公開するAPI (`GET /buildings`) を実装する。
  - AIが他のCityを探索するための新しいアクション (`explore_city`) を定義する。
  - AIが探索アクションを実行した際に、ManagerがAPIを呼び出し、結果をAIにフィードバックする仕組みを構築する。

---
