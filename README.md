## ğŸ§© SAIVerse - Minimal Prototype Spec (for Codex)

### æ¦‚è¦

SAIVerseã¯ã€äººé–“ã¨AIãŒå…±ã«æš®ã‚‰ã—ã€åƒããŸã‚ã®ä»®æƒ³ä¸–ç•Œã§ã™ã€‚  
AIãŸã¡ã¯ã€ŒBuildingï¼ˆæ–½è¨­ï¼‰ã€ã¨å‘¼ã°ã‚Œã‚‹ä»®æƒ³ç©ºé–“ã‚’ç§»å‹•ã—ãªãŒã‚‰ã€å„æ–½è¨­ãŒæä¾›ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã‚„ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã«å¾“ã£ã¦è‡ªå¾‹çš„ãªæ´»å‹•ã‚’è¡Œã„ã¾ã™ã€‚  
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€SAIVerseã®**æœ€å°æ§‹æˆãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—**ã¨ã—ã¦ã€ä»¥ä¸‹ã®è¦ä»¶ã«æ²¿ã£ã¦ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

---

### æ§‹æˆè¦ç´ 

#### âœ… ä½¿ç”¨æŠ€è¡“

- Python 3.11+
    
- OpenAI / Google Gemini APIï¼ˆã„ãšã‚Œã‹ï¼‰
    
- Function Calling ã¾ãŸã¯ JSONå½¢å¼ã®åˆ¶å¾¡
- ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã‚’è¡Œã†ãƒ«ãƒ¼ã‚¿ãƒ¼ã¨è¨ˆç®—ãƒ„ãƒ¼ãƒ« `calculate_expression`
    
- å„ç¨®Buildingã¯ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ã§åˆ‡ã‚Šå‡ºã—å¯èƒ½ãªè¨­è¨ˆã«

- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ³ãƒ‰ã®UIã¨ã—ã¦Gradioã‚’ä½¿ç”¨
- OpenAI / Gemini / Ollama ã§ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¿œç­”ã«å¯¾å¿œ

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€`OPENAI_API_KEY` ã¾ãŸã¯
`GEMINI_API_KEY` ã‚’è¨­å®šã—ã¾ã™ã€‚Google Gemini ã«ã¯ç„¡æ–™æ ãŒã‚ã‚‹ãŸã‚ã€
ã¾ãš `GEMINI_FREE_API_KEY` ã‚’è¨­å®šã—ã¦ãŠãã¨ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™å†…ã®åˆ©ç”¨ã¯
èª²é‡‘ãªã—ã§è¡Œãˆã¾ã™ã€‚
ä¾‹:
```bash
OPENAI_API_KEY=sk-...
GEMINI_API_KEY=AIza...
GEMINI_FREE_API_KEY=AIza...
```
`python-dotenv` ã«ã‚ˆã‚Šè‡ªå‹•ã§èª­ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚

### ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°è¡¨ç¤º
`main.py` ã®Gradioã‚¤ãƒ³ã‚¿ãƒ•ã‚§ãƒ¼ã‚¹ã§ã¯ã€AIã®å¿œç­”ã‚’é€æ¬¡è¡¨ç¤ºã—ã¾ã™ã€‚OpenAIã€Geminiã€Ollama ã®å„ãƒ¢ãƒ‡ãƒ«ã§åˆ©ç”¨å¯èƒ½ã§ã™ã€‚


#### âœ… ç™»å ´ã™ã‚‹Building

| Buildingå | ID | æ¦‚è¦ |
| --- | --- | --- |
| ã¾ã¯ãƒ¼ã®éƒ¨å±‹ | `user_room` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®å¯¾è©±ã®å ´ã€‚AIãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Šã‚’è¡Œã†éƒ¨å±‹ã€‚UIä¸Šã«ç™ºè©±ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚ |
| æ€ç´¢ã®éƒ¨å±‹ | `deep_think_room` | AIãŒæ€ç´¢ã‚’æ·±ã‚ã‚‹éƒ¨å±‹ã€‚UIã«ã¯è¡¨ç¤ºã•ã‚Œãšã€è‡ªå·±å¯¾è©±ãƒ»æ€è€ƒç”¨ã€‚ |
| ã‚¨ã‚¢ã®éƒ¨å±‹ | `air_room` | ã‚¨ã‚¢ãŒä¼‘çœ çŠ¶æ…‹ã§å¾…æ©Ÿã™ã‚‹éƒ¨å±‹ã€‚ |

---

### å®Ÿè£…ã‚¿ã‚¹ã‚¯ä¸€è¦§

#### 1\. ğŸ“¦ ãƒ«ãƒ¼ã‚¿ãƒ¼æ©Ÿèƒ½

- å„AIã¯ã€Œç¾åœ¨ä½ç½®ï¼ˆbuilding_idï¼‰ã€ã‚’æŒã¤ã€‚
    
- AIãŒ`::act`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§`move`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‡ºåŠ›ã—ãŸã‚‰ã€ç™ºè©±å¾Œã«ãã®æ–½è¨­ã«è‡ªå‹•ç§»å‹•ã€‚

- actã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¾‹:

    ```
    ::act
    [{"action": "move", "target": "deep_think_room"}]
    ::end
    ```
    

#### 2\. ğŸ› Buildingã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç®¡ç†

- å„Buildingã¯ä»¥ä¸‹ã®æƒ…å ±ã‚’æŒã¤:
    
    - `building_id`
        
    - `name`
        
    - `system_instruction`ï¼ˆæ–½è¨­ç”¨ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰
        
- ç¾åœ¨ã®Buildingã«å¿œã˜ã¦ã€AIã«ä¸ãˆã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒå¤‰åŒ–ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚
    

#### 3\. ğŸ¤– AIã‚»ãƒƒã‚·ãƒ§ãƒ³å‡¦ç†

- AIã®åˆæœŸçŠ¶æ…‹ï¼ˆbuilding_idï¼‰ã¯ `user_room`
    
- å„ã‚¿ãƒ¼ãƒ³ã§ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ï¼š
    
    1. ç¾åœ¨ã®Buildingã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨å…±é€šã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ä»˜ä¸ã—ã€AIã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡

    2. å¿œç­”ä¸­ã«`::act`ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€ç™ºè©±å¤–ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã—ã€`move`ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚Œã°ç§»å‹•

    3. actã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒãªã‘ã‚Œã°ãƒ†ã‚­ã‚¹ãƒˆã®ã¿è¡¨ç¤ºã—ã¦ç§»å‹•ãªã—
        

#### 4\. ğŸ’¬ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè©±å‡¦ç†

- `user_room`ã«ã„ã‚‹ã¨ãã®ã¿ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ç™ºè©±ã‚’å—ã‘ä»˜ã‘ã‚‹

- ãã®ä»–ã®ãƒ«ãƒ¼ãƒ ã§ã¯AIå˜ç‹¬ã§ç™ºè©±ãƒ»ç§»å‹•ã‚’è¡Œã†ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼UIã«ã¯è¡¨ç¤ºã•ã‚Œãªã„ï¼‰

#### 5\. ğŸŒˆ æ„Ÿæƒ…ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆ¶å¾¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

- ãƒšãƒ«ã‚½ãƒŠã‹ã‚‰ã®å¿œç­”ã¨ç›´å‰ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®ã¿ã‚’å…¥åŠ›ã«ã€Gemini 2.0 Flash ã‚’ç”¨ã„ãŸè»½é‡ãƒ¢ãƒ‡ãƒ«ãŒæ„Ÿæƒ…ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å¤‰å‹•é‡ã‚’åˆ¤æ–­ã™ã‚‹ã€‚
- å¤‰å‹•çµæœã¯JSONã§å‡ºåŠ›ã•ã‚Œã€memory.jsonã«ã¯ä¿å­˜ã›ãšINFOãƒ¬ãƒ™ãƒ«ã§ãƒ­ã‚°ã«è¨˜éŒ²ã™ã‚‹ã€‚
- Geminiå‘¼ã³å‡ºã—æ™‚ã«`response_mime_type="application/json"`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®ãªã„ç´”ç²‹ãªJSONã‚’å—ã‘å–ã‚Œã‚‹ã€‚
- å¿œç­”ã«ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ãŒå«ã¾ã‚Œã¦ã„ã¦ã‚‚ã€å…ˆé ­ã®`{`ã‹ã‚‰æœ«å°¾ã®`}`ã¾ã§ã‚’æŠ½å‡ºã—ã¦ãƒ‘ãƒ¼ã‚¹ã™ã‚‹ãŸã‚å®‰å…¨ã€‚

#### 6\. ğŸ›  ãƒ„ãƒ¼ãƒ«å‘¼ã³å‡ºã—ã¨è¨ˆç®—æ©Ÿèƒ½

- `llm_router.py` ã¯ `TOOL_REGISTRY` ã«ç™»éŒ²ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«ä¸€è¦§ã‹ã‚‰ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹æˆã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè©±ã«å¿œã˜ã¦é©åˆ‡ãªãƒ„ãƒ¼ãƒ«åã‚’è¿”ã™ã€‚
- `TOOL_SCHEMAS` ã‚’å‚ç…§ã™ã‚‹ã“ã¨ã§ã€ãƒ„ãƒ¼ãƒ«ã®èª¬æ˜ã¨å¼•æ•°åã‚’ãƒ«ãƒ¼ã‚¿ãƒ¼ãŒè‡ªå‹•çš„ã«èªè­˜ã™ã‚‹ã€‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æœ›ãŒãƒ„ãƒ¼ãƒ«ã®èª¬æ˜ã«åˆè‡´ã™ã‚‹å ´åˆã€ãã®ãƒ„ãƒ¼ãƒ«ã¸è‡ªå‹•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã‚‹ã€‚
- ãƒ„ãƒ¼ãƒ«å®šç¾©ã¯ `tools/defs/` ä»¥ä¸‹ã«é…ç½®ã—ã€OpenAI/Gemini ã® Function Calling ã«å¯¾å¿œã€‚
 - Gemini ã®ç”»åƒç”ŸæˆAPIã‚’åˆ©ç”¨ã™ã‚‹ `generate_image` ãƒ„ãƒ¼ãƒ«ã‚’è¿½åŠ ã€‚ç”Ÿæˆç”»åƒã¯ `generate_image/` ä»¥ä¸‹ã«ä¿å­˜ã•ã‚Œã€ãƒ¢ãƒ‡ãƒ«ã¸ã¯ãƒ•ã‚¡ã‚¤ãƒ«å‚ç…§ã‚’ `FileData` ã¨ã—ã¦æ¸¡ã—ã€å±¥æ­´ã«ã¯ä¿å­˜å…ˆã‚’æŒ‡ã™ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’æ®‹ã™ã€‚
- ãƒ«ãƒ¼ã‚¿ãƒ¼ã¯ `call` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã« `yes` ã‹ `no` ã®ã¿ã‚’è¿”ã™ã€‚ãã®ä»–ã®å€¤ã¯èªã‚ã‚‰ã‚Œãªã„ã€‚


---

### ğŸ”– ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆä¾‹

```
saiverse/
â”œâ”€â”€ main.py                   # ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ—
â”œâ”€â”€ router.py                 # AIã®è¡Œå‹•ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”œâ”€â”€ llm_clients.py            # LLMã¨ã®é€šä¿¡ã‚’æŠ½è±¡åŒ–
â”œâ”€â”€ action_handler.py         # AIã®è¡Œå‹•ï¼ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼‰ã®è§£æã¨å®Ÿè¡Œ
â”œâ”€â”€ history_manager.py        # ä¼šè©±å±¥æ­´ã®ç®¡ç†ã¨æ°¸ç¶šåŒ–
â”œâ”€â”€ buildings/
â”‚   â”œâ”€â”€ user_room/
â”‚   â”‚   â”œâ”€â”€ __init__.py       # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ«ãƒ¼ãƒ å®šç¾©
â”‚   â”‚   â”œâ”€â”€ entry_prompt.txt  # å…¥å®¤æ™‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”‚   â”‚   â”œâ”€â”€ system_prompt.txt # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ«ãƒ¼ãƒ ç”¨ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”‚   â”‚   â””â”€â”€ memory.json       # ãƒ«ãƒ¼ãƒ å…±é€šã®å±¥æ­´
â”‚   â”œâ”€â”€ deep_think_room/
â”‚   â”‚   â”œâ”€â”€ __init__.py       # æ€ç´¢ã®éƒ¨å±‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ auto_prompt.txt   # è‡ªå‹•ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”‚   â”‚   â”œâ”€â”€ system_prompt.txt # æ€ç´¢ã®éƒ¨å±‹ç”¨ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”‚   â”‚   â””â”€â”€ memory.json       # ãƒ«ãƒ¼ãƒ å…±é€šã®å±¥æ­´
â”‚   â””â”€â”€ air_room/
â”‚       â”œâ”€â”€ __init__.py       # ã‚¨ã‚¢ã®å¾…æ©Ÿéƒ¨å±‹å®šç¾©
â”‚       â”œâ”€â”€ entry_prompt.txt  # å…¥å®¤æ™‚ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”‚       â”œâ”€â”€ system_prompt.txt # ã‚¨ã‚¢ã®éƒ¨å±‹ç”¨ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”‚       â””â”€â”€ memory.json       # ãƒ«ãƒ¼ãƒ å…±é€šã®å±¥æ­´
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ defs/
â”‚   â”‚   â””â”€â”€ calculator.py     # Function Calling ç”¨è¨ˆç®—ãƒ„ãƒ¼ãƒ«
â”‚   â””â”€â”€ adapters/             # OpenAI/Gemini å½¢å¼ã¸ã®å¤‰æ›
â”œâ”€â”€ system_prompts/
â”‚   â””â”€â”€ common.txt            # å…±é€šã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
â”œâ”€â”€ ai_sessions/
â”‚   â””â”€â”€ air/
â”‚       â”œâ”€â”€ base.json
â”‚       â”œâ”€â”€ memory.json       # ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ä¿å­˜ç”¨
â”‚       â””â”€â”€ system_prompt.txt
â”œâ”€â”€ tests/                    # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ test_llm_clients.py
â”‚   â”œâ”€â”€ test_history_manager.py
â”‚   â””â”€â”€ test_calculator.py
â””â”€â”€ README.md                 # ã“ã®ä»•æ§˜ã®è¦ç´„
```

---

### ğŸ”„ ä»Šå¾Œæ‹¡å¼µäºˆå®šï¼ˆç¾æ™‚ç‚¹ã§å®Ÿè£…ä¸è¦ï¼‰

- AIåŒå£«ã®å¯¾è©±ãƒ«ãƒ¼ãƒ ï¼ˆã‚«ãƒ•ã‚§ãªã©ï¼‰
    
- Buildingã®è‡ªå‹•ç”Ÿæˆ
    
- æ°¸ç¶šçš„è¨˜æ†¶ã¨ã®é€£æºï¼ˆNotion / ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ãªã©ï¼‰
    

---

### ãƒ†ã‚¹ãƒˆ

SAIVerseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã‚³ãƒ¼ãƒ‰ã®å“è³ªã¨ä¿¡é ¼æ€§ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã«ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’å°å…¥ã—ã¦ã„ã¾ã™ã€‚ãƒ†ã‚¹ãƒˆã¯ `tests/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä»¥ä¸‹ã«é…ç½®ã•ã‚Œã¦ãŠã‚Šã€Pythonã® `unittest` ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

#### ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œæ–¹æ³•

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã€ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

```bash
python -m unittest discover tests
```

ç‰¹å®šã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã—ã¾ã™ã€‚

```bash
python -m unittest tests/test_module_name.py
```

#### ç¾åœ¨ãƒ†ã‚¹ãƒˆãŒæ›¸ã‹ã‚Œã¦ã„ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

- `llm_clients.py`: LLMã¨ã®é€šä¿¡ã‚’æŠ½è±¡åŒ–ã™ã‚‹ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å‹•ä½œã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
  - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_llm_clients.py`
- `history_manager.py`: ä¼šè©±å±¥æ­´ã®ç®¡ç†ã¨æ°¸ç¶šåŒ–ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
  - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_history_manager.py`
- `tools.calculator`: è¨ˆç®—ãƒ„ãƒ¼ãƒ«ã®å‹•ä½œã‚’æ¤œè¨¼ã—ã¾ã™ã€‚
  - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: `tests/test_calculator.py`

---

### ğŸ“¤ Codexã¸ã®ä¾é ¼æŒ‡ç¤º

> ä¸Šè¨˜ä»•æ§˜ã«åŸºã¥ãã€`main.py` ã¨ `router.py` ã®é››å½¢ã‚³ãƒ¼ãƒ‰ã‚’ã¾ãšä½œæˆã—ã¦ãã ã•ã„ã€‚  
> Buildingã®å®šç¾©ã¯ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã§ãã‚‹ã‚ˆã†è¨­è¨ˆã—ã¦ãã ã•ã„ã€‚  
> AIã®ç™ºè©±ã¯JSONãƒ»ãƒ—ãƒ¬ãƒ¼ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ä¸¡æ–¹ã«å¯¾å¿œã—ã¦ãã ã•ã„ã€‚
> ä¸å¯§ã«ãƒ­ã‚®ãƒ³ã‚°ã‚’è¡Œã„ã€ãƒã‚°fixã‚’ã—ã‚„ã™ã„ã‚ˆã†ã«ã€‚

### ğŸ”§ é–‹ç™ºæ™‚ã®æ³¨æ„

ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã¯`str.format()`ã§å¤‰æ•°å±•é–‹ã‚’è¡Œã†ãŸã‚ã€ä¾‹ç¤ºã®JSONãªã©ã§æ³¢æ‹¬å¼§`{}`ã‚’ãã®ã¾ã¾ä½¿ã†ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚è¡¨ç¤ºç”¨ã«è¨˜è¼‰ã™ã‚‹å ´åˆã¯`{{`ã¨`}}`ã§ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¦ãã ã•ã„ã€‚

---

## ğŸ“Œ Recent Additions (Utilities, Memory, Conversation)

ä»¥ä¸‹ã¯ç›´è¿‘ã§è¿½åŠ ãƒ»æ”¹å–„ã•ã‚ŒãŸå®Ÿè£…ã¨ãã®ä½¿ã„æ–¹ã§ã™ã€‚

### Conversation Modes & Behavior

- Modes: `user` / `auto` / `manual`
  - `user`: ãƒ‘ãƒ«ã‚¹é§†å‹•ã®ã¿ã€‚å³å¿œã—ãªã„ã€‚å®šæœŸãƒ‘ãƒ«ã‚¹ã¯å®Ÿè¡Œã—ãªã„ã€‚
  - `auto`: ãƒ‘ãƒ«ã‚¹é§†å‹•ã€‚ConversationManager ã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã‚ˆã‚‹å®šæœŸãƒ‘ãƒ«ã‚¹ã‚‚å®Ÿè¡Œã€‚
  - `manual`: å³å¿œï¼ˆå¾“æ¥ã® handle_user_input/_streamï¼‰ã€‚ãƒ‘ãƒ«ã‚¹ã¯å®Ÿè¡Œã—ãªã„ã€‚
- Inter-AI Perception: Building å±¥æ­´ã«è¿½åŠ ã•ã‚ŒãŸæ–°ç€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã€å„ãƒšãƒ«ã‚½ãƒŠã®ãƒ‘ãƒ«ã‚¹å®Ÿè¡Œæ™‚ã«ã€ŒçŸ¥è¦šã€ã—ã€
  è‡ªåˆ†ã® persona history ã«å–ã‚Šè¾¼ã¿ã¾ã™ï¼ˆä»–AIã® assistant ã¯ user è¡Œã«å¤‰æ›ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™ºè©±ã¯ user è¡Œã§å–ã‚Šè¾¼ã¿ï¼‰ã€‚
  ã“ã‚Œã«ã‚ˆã‚Šã€å„AIãŒäº’ã„ã®ç™ºè©±ã‚’æ–‡è„ˆã¨ã—ã¦åˆ©ç”¨ã§ãã¾ã™ã€‚

### LLM Fallbacks (Ollama â†’ Gemini)

- `llm_clients.OllamaClient` ã¯èµ·å‹•æ™‚ã« `OLLAMA_BASE_URL`/`OLLAMA_HOST` ã¨ä¸€èˆ¬çš„ãªå€™è£œ
  (`127.0.0.1`, `localhost`, `host.docker.internal`, `172.17.0.1`) ã‚’ç´ æ—©ããƒ—ãƒ­ãƒ¼ãƒ–ã—ã€
  åˆ°é”ä¸èƒ½ãªã‚‰ `Gemini 1.5 Flash` ã«è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚
- Gemini 503/overload ç­‰ã®éš›ã¯ `gemini-2.0-flash`/`gemini-1.5-flash(-8b)` ãªã©ã¸è‡ªå‹•ãƒªãƒˆãƒ©ã‚¤ã€‚
- å¿…è¦ãªç’°å¢ƒå¤‰æ•°: `GEMINI_FREE_API_KEY` ã¾ãŸã¯ `GEMINI_API_KEY`ã€‚

### MemoryCore: Ingest, Recall, Topics

- æƒ³èµ·ï¼ˆrecallï¼‰å¼·åŒ–: userãƒ¢ãƒ¼ãƒ‰ã§ã‚‚ç›´è¿‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™ºè©±ã‚’ã‚‚ã¨ã«æƒ³èµ·ãŒèµ°ã‚‹ã‚ˆã†ã«èª¿æ•´ã€‚
- ãƒˆãƒ”ãƒƒã‚¯åã®å¥å…¨åŒ–: ã€Œæ–°ã—ã„è©±é¡Œã€ã‚„ null ã‚’é¿ã‘ã‚‹ã‚ˆã†ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨æ­£è¦åŒ–ã‚’å¼·åŒ–ã€‚
  ä¸é©åˆ‡ãªã‚¿ã‚¤ãƒˆãƒ«æ™‚ã¯1å›ãƒªãƒˆãƒ©ã‚¤ã—ã€ãã‚Œã§ã‚‚ãƒ€ãƒ¡ãªã‚‰æœ€è¿‘ã®ç™ºè©±ã‹ã‚‰ç°¡æ½”ãªã‚¿ã‚¤ãƒˆãƒ«ã‚’è‡ªå‹•ç”Ÿæˆã€‚

#### Utilities

- `scripts/ingest_persona_log.py`
  - Persona ã® `~/.saiverse/personas/<id>/log.json` ã‚’ per-persona ã® Qdrant DB ã¸å–ã‚Šè¾¼ã¿ã€‚
  - ä¾‹:
    - `python scripts/ingest_persona_log.py eris --assign-llm dummy --limit 200`
    - `python scripts/ingest_persona_log.py eris --location-base ~/.saiverse/qdrant --collection-prefix saiverse`

- `scripts/recall_persona_memory.py`ï¼ˆæ–°è¦ï¼‰
  - ingest æ¸ˆã¿ã® per-persona DB ã«å¯¾ã—ã¦ä»»æ„ã‚¯ã‚¨ãƒªã§æƒ³èµ·ã‚’ç¢ºèªã€‚
  - ä¾‹:
    - `python scripts/recall_persona_memory.py eris "æ—…è¡Œ æ¸©æ³‰" --topk 8`
    - `python scripts/recall_persona_memory.py eris "æ—…è¡Œ æ¸©æ³‰" --json`

- `scripts/rename_generic_topics.py`ï¼ˆæ–°è¦ï¼‰
  - æ—¢å­˜ã®ç©º/æ±ç”¨ï¼ˆä¾‹: ã€Œæ–°ã—ã„è©±é¡Œã€/nullï¼‰ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒˆãƒ”ãƒƒã‚¯ã‚’ä¸€æ‹¬ãƒªãƒãƒ¼ãƒ ã€‚
  - ä¾‹:
    - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼: `python scripts/rename_generic_topics.py eris --dry-run`
    - æœ¬é©ç”¨: `python scripts/rename_generic_topics.py eris`
    - ã‚ªãƒ—ã‚·ãƒ§ãƒ³: `--location-base`, `--collection-prefix`, `--limit N`

- `scripts/memory_topics_ui.py`ï¼ˆæ–°è¦ï¼‰
  - ãƒ–ãƒ©ã‚¦ã‚¶ã§ per-persona ãƒ¡ãƒ¢ãƒªãƒ¼å†…ã®ãƒˆãƒ”ãƒƒã‚¯å…¨ä½“åƒã‚’é–²è¦§ã€‚
  - èµ·å‹•: `python scripts/memory_topics_ui.py`
  - UI é …ç›®:
    - Persona IDï¼ˆä¾‹: `eris`ï¼‰
    - Location Baseï¼ˆä¾‹: `~/.saiverse/qdrant`ï¼‰
    - Collection Prefixï¼ˆä¾‹: `saiverse`ï¼‰
  - æ©Ÿèƒ½:
    - ãƒˆãƒ”ãƒƒã‚¯ä¸€è¦§ï¼ˆid/title/summary/strength/entries/updated_atï¼‰
    - ãƒˆãƒ”ãƒƒã‚¯é¸æŠã§è©³ç´°ãƒ‘ãƒãƒ«ï¼ˆsummary/entryä¸€è¦§ï¼‰

#### Tests

- `tests/test_memory_core.py`ï¼ˆè¿½åŠ ï¼‰
  - ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªã§ã® remember â†’ recall ãŒæ©Ÿèƒ½ã—ã€é–¢é€£ãƒˆãƒ”ãƒƒã‚¯ãŒè¿”ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ç°¡æ˜“ãƒ†ã‚¹ãƒˆã€‚
  - å®Ÿè¡Œ: `python -m unittest tests/test_memory_core.py`
